<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Há»‡ Thá»‘ng Affiliate Gia ÄÃ¬nh 2026</title>
    <style>
        :root { --p: #ee4d2d; --s: #1877F2; --v: #9b59b6; --g: #27ae60; --dark: #2d3436; }
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; padding: 20px; margin: 0; }
        .box { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h2 { color: var(--p); border-bottom: 2px solid #eee; padding-bottom: 10px; margin-top: 0; }
        
        /* Member Selection */
        .member-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 10px; margin: 15px 0; max-height: 200px; overflow-y: auto; padding: 10px; border: 1px inset #eee; }
        .m-btn { padding: 8px; border: 1px solid #ddd; border-radius: 8px; cursor: pointer; background: #fff; font-size: 11px; text-align: left; }
        .m-btn.active { background: var(--v); color: white; border-color: var(--v); font-weight: bold; }

        /* Table & Inputs */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { background: var(--dark); color: white; padding: 12px; font-size: 13px; }
        td { border-bottom: 1px solid #eee; padding: 12px; text-align: center; }
        input, select, textarea { padding: 8px; border: 1px solid #ddd; border-radius: 5px; }
        .aff-link { width: 90%; border: 1.5px solid #ff7675; background: #fff5f5; font-size: 11px; }

        .btn { border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; color: white; font-weight: bold; transition: 0.3s; }
        .btn-ai { margin: 2px; font-size: 10px; }
        
        /* Result Area */
        #finalResult { width: 100%; height: 150px; background: #f9f9f9; border: 2px dashed var(--g); padding: 10px; margin-top: 10px; font-family: 'Courier New', monospace; }
        .img-slot { width: 60px; height: 60px; border: 2px dashed #ccc; border-radius: 8px; margin: auto; cursor: pointer; overflow: hidden; display: flex; align-items: center; justify-content: center; }
        .img-slot img { width: 100%; height: 100%; object-fit: cover; }
    </style>
</head>
<body>

<div style="max-width: 1200px; margin: auto;">
    <h1 style="text-align: center; color: var(--p);">ğŸš€ Há»† THá»NG ÄIá»€U HÃ€NH Tá»”NG Lá»°C</h1>

    <div class="box">
        <h2>1. CHá»ŒN HOáº¶C NHáº¬P NGÆ¯á»œI Má»šI</h2>
        <div style="background: #e3f2fd; padding: 15px; border-radius: 10px; margin-bottom: 10px; display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
            <strong>ThÃªm nhanh:</strong>
            <input type="text" id="newName" placeholder="Há» tÃªn má»›i...">
            <input type="number" id="newAge" style="width:60px" placeholder="Tuá»•i">
            <select id="newGen"><option value="Nam">Nam</option><option value="Ná»¯">Ná»¯</option></select>
            <button class="btn" style="background:var(--s)" onclick="addNewMember()">+ ThÃªm vÃ o danh sÃ¡ch</button>
            <button class="btn" style="background:var(--dark)" onclick="resetSelection()">ğŸ”„ Chá»n láº¡i tá»« Ä‘áº§u</button>
        </div>
        <div class="member-grid" id="memberList"></div>
        <div id="statusHeader" style="background:var(--v); color:white; padding:10px; border-radius:8px; text-align:center; font-weight:bold; font-size:18px">
            ğŸ‘‰ BÆ¯á»šC 1: HÃƒY Báº¤M CHá»ŒN Má»˜T NGÆ¯á»œI TRÃŠN DANH SÃCH!
        </div>
    </div>

    <div class="box">
        <h2>2. NHáº¬P FILE CSV & Xá»¬ LÃ Sáº¢N PHáº¨M</h2>
        <input type="file" id="csvInp" multiple accept=".csv" class="btn" style="background:#eee; color:#333">
        <button class="btn" style="background:var(--g); margin-left:10px" onclick="exportFilesJson()">ğŸ’¾ Xuáº¥t files.json (LÃªn GitHub)</button>
        
        <table>
            <thead>
                <tr>
                    <th width="80">áº¢nh</th>
                    <th>TÃªn Sáº£n Pháº©m</th>
                    <th width="250">Link Affiliate (Bá»‘ dÃ¡n)</th>
                    <th>Gá»i AI Ká»ƒ Chuyá»‡n</th>
                </tr>
            </thead>
            <tbody id="productArea"></tbody>
        </table>
    </div>

    <div class="box">
        <h2>3. Káº¾T QUáº¢ Ká»‚ CHUYá»†N (Copy Ä‘á»ƒ Ä‘Äƒng Facebook/Zalo)</h2>
        <p style="font-size:12px; color:#666">Sau khi AI ká»ƒ chuyá»‡n xong, hÃ£y dÃ¡n ná»™i dung vÃ o Ä‘Ã¢y Ä‘á»ƒ kiá»ƒm tra trÆ°á»›c khi Ä‘Äƒng:</p>
        <textarea id="finalResult" placeholder="Ná»™i dung truyá»‡n sáº½ hiá»‡n á»Ÿ Ä‘Ã¢y sau khi AI viáº¿t hoáº·c bÃ© dÃ¡n vÃ o Ä‘á»ƒ chá»‰nh sá»­a..."></textarea>
        <div style="margin-top:10px">
            <button class="btn" style="background:var(--s)" onclick="copyFinal()">ğŸ“‹ Copy toÃ n bá»™ Ä‘á»ƒ ÄÄƒng bÃ i</button>
            <button class="btn" style="background:var(--p)" onclick="document.getElementById('finalResult').value=''">ğŸ—‘ï¸ XÃ³a lÃ m láº¡i</button>
        </div>
    </div>
</div>

<script>
    // 1. Danh sÃ¡ch 32 ngÆ°á»i chuáº©n
    let members = JSON.parse(localStorage.getItem('saved_members')) || [
        {n:"NGUYá»„N KHáº®C NÄ‚NG", d:"1944-06-04", g:"Nam"}, {n:"TÃ” THá»Š HÃ€", d:"1948-08-29", g:"Ná»¯"},
        {n:"NGUYá»„N MINH NAM", d:"1971-03-03", g:"Nam"}, {n:"THÃ‚N THá»Š KIM ANH", d:"1981-09-23", g:"Ná»¯"},
        {n:"NGUYá»„N TÃ” NGÃ‚N AN", d:"2014-09-28", g:"Ná»¯"}, {n:"NGUYá»„N TÃ” MINH CHÃ‚U", d:"2016-07-25", g:"Ná»¯"},
        {n:"NGUYá»„N TÃ” BÃCH NGá»ŒC", d:"2020-02-05", g:"Ná»¯"}, {n:"NGUYá»„N THá»Š MINH Háº°NG", d:"1974-01-07", g:"Ná»¯"},
        {n:"NGÃ” QUÃ CÆ¯á»œNG", d:"1973-05-23", g:"Nam"}, {n:"NGÃ” GIA BÃCH", d:"2000-10-12", g:"Nam"},
        {n:"NGÃ” GIA LINH", d:"2005-04-05", g:"Ná»¯"}, {n:"NGUYá»„N THá»Š MINH PHÆ¯Æ NG", d:"1978-11-06", g:"Ná»¯"},
        {n:"HOÃ€NG ANH DÅ¨NG", d:"1978-09-21", g:"Nam"}, {n:"HOÃ€NG Háº¢I VINH", d:"2010-06-03", g:"Nam"},
        {n:"HOÃ€NG THIÃŠN Báº CH ANH", d:"2015-11-14", g:"Ná»¯"}, {n:"TÃ” KIM HUá»†", d:"1960-08-09", g:"Ná»¯"},
        {n:"NGUYá»„N TUáº¤N ANH", d:"1983-10-23", g:"Nam"}, {n:"NGUYá»„N THáº¾ ANH", d:"2001-03-24", g:"Nam"},
        {n:"NGÃ” THá»Š MAI", d:"1948-12-12", g:"Ná»¯"}, {n:"TÃ” VIá»†T HÆ¯NG", d:"1996-06-17", g:"Nam"},
        {n:"TÃ” THá»Š Há»’NG", d:"1964-10-10", g:"Ná»¯"}, {n:"VÅ¨ VÄ‚N HIá»†P", d:"1974-04-24", g:"Nam"},
        {n:"NGUYá»„N THá»Š CHI", d:"1946-02-08", g:"Ná»¯"}, {n:"NGUYá»„N TÃ‚N Báº®C", d:"1957-11-30", g:"Nam"},
        {n:"NGUYá»„N THá»Š TÃ‚M", d:"1954-08-08", g:"Ná»¯"}, {n:"THÃ‚N VÄ‚N GIá»®", d:"1955-04-18", g:"Nam"},
        {n:"NGUYá»„N THá»Š BÃŒNH", d:"1958-05-21", g:"Ná»¯"}, {n:"THÃ‚N THá»Š BÃCH NGUYá»†T", d:"1980-05-21", g:"Ná»¯"},
        {n:"THÃ‚N VÄ‚N TUáº¤N", d:"1983-05-21", g:"Nam"}, {n:"THÃ‚N Yáº¾N NHI", d:"2010-03-26", g:"Ná»¯"},
        {n:"LÃŠ THá»Š PHÆ¯Æ NG", d:"1990-06-26", g:"Ná»¯"}, {n:"NGUYá»„N HOÃ€I NAM", d:"2004-06-02", g:"Nam"}
    ];

    let warehouse = JSON.parse(localStorage.getItem('full_warehouse_2026')) || [];
    let selectedMem = null;

    // --- QUáº¢N LÃ THÃ€NH VIÃŠN ---
    function renderMembers() {
        const grid = document.getElementById('memberList');
        grid.innerHTML = members.map(m => {
            let age = m.age ? m.age : Math.floor((new Date() - new Date(m.d))/31557600000);
            return `<button class="m-btn" onclick="selectM('${m.n}', '${m.g}', ${age})">
                <strong>${m.n}</strong><br><small>${m.g} - ${age}t</small>
            </button>`;
        }).join('');
    }

    function selectM(name, gen, age) {
        selectedMem = { name, gen, age };
        document.getElementById('statusHeader').innerText = `âœ… ÄÃƒ CHá»ŒN: ${name} (${gen} - ${age}t). Má»œI BÃ‰ CHá»ŒN Sáº¢N PHáº¨M!`;
        document.querySelectorAll('.m-btn').forEach(b => b.classList.toggle('active', b.innerText.includes(name)));
    }

    function addNewMember() {
        const n = document.getElementById('newName').value.trim();
        const age = document.getElementById('newAge').value;
        const g = document.getElementById('newGen').value;
        if(!n || !age) return alert("Nháº­p Ä‘á»§ tÃªn vÃ  tuá»•i nhÃ©!");
        members.push({ n, age: parseInt(age), g });
        localStorage.setItem('saved_members', JSON.stringify(members));
        renderMembers();
    }

    function resetSelection() {
        selectedMem = null;
        document.getElementById('statusHeader').innerText = "ğŸ‘‰ BÆ¯á»šC 1: HÃƒY Báº¤M CHá»ŒN Má»˜T NGÆ¯á»œI TRÃŠN DANH SÃCH!";
        document.querySelectorAll('.m-btn').forEach(b => b.classList.remove('active'));
    }

    // --- QUáº¢N LÃ HÃ€NG HÃ“A ---
    document.getElementById('csvInp').onchange = async (e) => {
        const files = Array.from(e.target.files);
        for (const file of files) {
            const text = await file.text();
            const lines = text.split('\n').slice(1);
            lines.forEach(l => {
                const c = l.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                if(c.length >= 8) {
                    const id = c[0].trim();
                    if(!warehouse.some(p => p.id === id)) {
                        warehouse.push({
                            id: id, name: c[1]?.replace(/\[.*?\]|\(.*?\)|"/g, '').split(' ').slice(0, 5).join(' ').trim(),
                            l: c[8]?.trim() || c[7]?.trim(), img: '', done: false
                        });
                    }
                }
            });
        }
        save();
    };

    function renderWarehouse() {
        const tbody = document.getElementById('productArea');
        tbody.innerHTML = warehouse.slice(-15).reverse().map(p => `
            <tr style="${p.done ? 'opacity:0.5' : ''}">
                <td><div class="img-slot" onclick="uploadImg('${p.id}')">${p.img ? `<img src="${p.img}">` : '+'}</div></td>
                <td><input class="edit-name" style="width:100%" value="${p.name}" onchange="updateItem('${p.id}', 'name', this.value)"></td>
                <td><input class="aff-link" value="${p.l.includes('product') ? '' : p.l}" onchange="updateItem('${p.id}', 'l', this.value)" placeholder="DÃ¡n link rÃºt gá»n..."></td>
                <td>
                    <button class="btn btn-ai" style="background:var(--v)" onclick="callAI('DeepSeek', '${p.id}')">DeepSeek</button>
                    <button class="btn btn-ai" style="background:var(--s)" onclick="callAI('Gemini', '${p.id}')">Gemini</button>
                </td>
            </tr>
        `).join('');
    }

    function callAI(ai, id) {
        if(!selectedMem) return alert("BÃ© Æ¡i! Pháº£i chá»n ngÆ°á»i nháº­n á»Ÿ BÆ°á»›c 1 trÆ°á»›c Ä‘Ã£!");
        const p = warehouse.find(x => x.id === id);
        if(!p.l || p.l.includes('product')) return alert("Bá»‘ chÆ°a dÃ¡n link rÃºt gá»n cho mÃ³n nÃ y!");

        // Táº O PROMPT CHUáº¨N
        const prompt = `Viáº¿t má»™t cÃ¢u chuyá»‡n ngá»¥ ngÃ´n hoáº·c cá»• tÃ­ch cá»±c ká»³ hÃ i hÆ°á»›c vÃ  ngáº¯n gá»n cho Facebook. 
            NhÃ¢n váº­t chÃ­nh: ${selectedMem.name} (${selectedMem.gen}, ${selectedMem.age} tuá»•i). 
            Váº­t pháº©m quan trá»ng: ${p.name}. 
            YÃªu cáº§u: Lá»“ng ghÃ©p cÃ´ng dá»¥ng sáº£n pháº©m dÃ­ dá»m, káº¿t bÃ i cÃ³ lá»i kÃªu gá»i mua hÃ ng táº¡i link: ${p.l}`;
        
        // COPY PROMPT VÃ€O CLIPBOARD
        navigator.clipboard.writeText(prompt).then(() => {
            alert(`âœ… ÄÃ£ copy xong Prompt cho ${ai}!\n\nBÃ© chá»‰ cáº§n dÃ¡n (Ctrl+V) vÃ o Ã´ chat cá»§a AI lÃ  xong.`);
            window.open(ai === 'DeepSeek' ? "https://chat.deepseek.com" : "https://gemini.google.com/app", "_blank");
        });
    }

    function uploadImg(id) {
        const inp = document.createElement('input'); inp.type = 'file'; inp.accept = 'image/*';
        inp.onchange = (e) => {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = (ev) => {
                const img = new Image();
                img.onload = () => {
                    const cvs = document.createElement('canvas'); cvs.width = 150; cvs.height = 150;
                    cvs.getContext('2d').drawImage(img, 0, 0, 150, 150);
                    updateItem(id, 'img', cvs.toDataURL('image/jpeg', 0.6));
                };
                img.src = ev.target.result;
            };
            reader.readAsDataURL(file);
        };
        inp.click();
    }

    function updateItem(id, k, v) {
        const idx = warehouse.findIndex(x => x.id === id);
        warehouse[idx][k] = v;
        save();
    }

    function save() {
        localStorage.setItem('full_warehouse_2026', JSON.stringify(warehouse));
        renderWarehouse();
    }

    function exportFilesJson() {
        const blob = new Blob([JSON.stringify(warehouse, null, 2)], {type: 'application/json'});
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'files.json'; a.click();
    }

    function copyFinal() {
        const txt = document.getElementById('finalResult');
        txt.select();
        document.execCommand('copy');
        alert("ÄÃ£ copy xong! BÃ© má»Ÿ Facebook hoáº·c Zalo ra dÃ¡n vÃ o Ä‘Äƒng bÃ i nhÃ©!");
    }

    renderMembers();
    renderWarehouse();
</script>
</body>
</html>
