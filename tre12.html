<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Kho cá»§a con</title>
    <style>
        /* ThÃªm hiá»‡u á»©ng cho ká»‡ hÃ ng */
        .product-card:hover { transform: scale(1.02); transition: 0.3s; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .btn-add { background: #2196F3; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; margin: 10px; }
    </style>
</head>
<body style="font-family: sans-serif; margin: 0; background: #f0f2f5;">

<div style="background: white; padding: 10px; text-align: center; border-bottom: 2px solid #ee4d2d;">
    <h2 style="margin: 0; color: #ee4d2d;">ðŸ“¦ KHO Cá»¦A CON</h2>
</div>

<div style="text-align: center; background: #e3f2fd; padding: 10px;">
    <button class="btn-add" onclick="themBanMoi()">ðŸŽ‚ ThÃªm Báº¡n BÃ¨ & NgÃ y Sinh</button>
    <div id="birthday-alert" style="color: #d32f2f; font-weight: bold; margin-top: 5px;"></div>
</div>

<iframe src="../index.html?tre=12" style="width:100%;height:60vh;border:none"></iframe>

<div id="market" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; padding: 15px; background: #f9f9f9; border-radius: 10px; margin: 10px;"></div>

<script src="../js/tre-score.js"></script>
<script src="../js/post-proof.js"></script>
<script src="../js/badge.js"></script>
<script src="../js/ranking.js"></script>
<script src="../js/time-lock.js"></script>
<script src="../js/reminder.js"></script>
<script src="../js/reward.js"></script>

<script>
    // 1. HÃ m thÃªm báº¡n bÃ¨ má»›i (LÆ°u vÃ o mÃ¡y) [cite: 2026-01-31]
    function themBanMoi() {
        const name = prompt("Nháº­p tÃªn báº¡n bÃ¨:");
        const bday = prompt("Nháº­p ngÃ y sinh (Äá»‹nh dáº¡ng: NgÃ y-ThÃ¡ng, vÃ­ dá»¥: 03-02):");
        if (name && bday) {
            let list = JSON.parse(localStorage.getItem('friend_list')) || [];
            list.push({ name: name, bday: bday });
            localStorage.setItem('friend_list', JSON.stringify(list));
            checkBirthday(); // Kiá»ƒm tra ngay sau khi thÃªm
            alert("ÄÃ£ nhá»› sinh nháº­t báº¡n " + name);
        }
    }

    // 2. HÃ m nháº¯c sinh nháº­t hÃ´m nay
    function checkBirthday() {
        const today = new Date();
        const currentDay = String(today.getDate()).padStart(2, '0') + "-" + String(today.getMonth() + 1).padStart(2, '0');
        let list = JSON.parse(localStorage.getItem('friend_list')) || [];
        let congrats = list.filter(f => f.bday === currentDay);
        
        const alertBox = document.getElementById('birthday-alert');
        if (congrats.length > 0) {
            alertBox.innerHTML = "ðŸŽ‰ ChÃºc má»«ng sinh nháº­t: " + congrats.map(f => f.name).join(", ") + "! Äá»«ng quÃªn chá»n quÃ  nhÃ©!";
        }
    }

    // 3. HÃ m bá»‘c hÃ ng tá»« Robot
    async function loadRobotData() {
        try {
            const response = await fetch('database.csv');
            const text = await response.text();
            const rows = text.split('\n').slice(1); 
            const market = document.getElementById('market');
            
            market.innerHTML = rows.map(row => {
                const columns = row.split(',');
                if(columns.length < 4) return '';
                const [name, price, img, link] = columns;
                return `
                    <div class="product-card" style="background:white; border:1px solid #ddd; border-radius:10px; padding:10px; text-align:center; cursor:pointer;" onclick="window.open('${link.trim()}')">
                        <img src="${img.trim()}" style="width:100%; height:120px; object-fit:cover; border-radius:5px;">
                        <div style="font-size:12px; margin:5px 0; height:32px; overflow:hidden; font-weight:bold;">${name}</div>
                        <div style="color:#ee4d2d; font-weight:bold;">${parseInt(price).toLocaleString()}Ä‘</div>
                    </div>
                `;
            }).join('');
        } catch (e) {
            document.getElementById('market').innerHTML = "<p style='text-align:center'>Robot Ä‘ang Ä‘i chá»£, vui lÃ²ng quay láº¡i sau!</p>";
        }
    }

    // Khá»Ÿi cháº¡y khi má»Ÿ web
    loadRobotData();
    checkBirthday();
</script>

</body>
</html>
