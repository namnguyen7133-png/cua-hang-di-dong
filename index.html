<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>H·ªá Th·ªëng Marketing 3 Anh Em - V18.3</title>
    <style>
        :root { --p: #ee4d2d; --s: #1877F2; --v: #9b59b6; --g: #27ae60; --bg: #f8f9fa; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); padding: 20px; font-size: 14px; }
        .step-card { background: white; border-radius: 15px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border-top: 6px solid #ccc; }
        
        /* M√†u s·∫Øc theo b∆∞·ªõc */
        .s1 { border-color: #3498db; } .s2 { border-color: #9b59b6; } .s3 { border-color: #e67e22; }
        .s4 { border-color: #2ecc71; } .s5 { border-color: #f1c40f; } .s6 { border-color: #e74c3c; }

        h2 { margin-top: 0; font-size: 18px; display: flex; align-items: center; gap: 10px; }
        .badge { background: #333; color: white; padding: 2px 10px; border-radius: 20px; font-size: 14px; }
        
        .m-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; margin-top: 10px; }
        .m-btn { padding: 10px; border: 1px solid #ddd; border-radius: 8px; cursor: pointer; background: white; text-align: left; transition: 0.2s; }
        .m-btn.active { background: var(--v); color: white; border-color: var(--v); }
        
        .price-filters { display: flex; gap: 10px; margin: 10px 0; }
        .p-btn { flex: 1; padding: 10px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; background: #eee; }
        .p-btn.active { background: var(--p); color: white; }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; background: white; }
        th { background: #f1f1f1; padding: 12px; text-align: left; }
        td { padding: 12px; border-bottom: 1px solid #eee; }
        
        .inp { padding: 8px; border: 1px solid #ccc; border-radius: 5px; width: 100%; box-sizing: border-box; }
        .btn-action { padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; color: white; }
    </style>
</head>
<body>

<h1 style="text-align: center; color: var(--s);">üöÄ QUY TR√åNH MARKETING 6 B∆Ø·ªöC</h1>

<div class="step-card s1">
    <h2><span class="badge">1</span> NH·∫¨P KHO H√ÄNG (CSV)</h2>
    <input type="file" id="csv" multiple accept=".csv" style="padding: 10px; background: #e3f2fd; border-radius: 8px; width: 100%;">
</div>

<div class="step-card s2">
    <h2><span class="badge">2</span> CH·ªåN NG∆Ø·ªúI MAY M·∫ÆN</h2>
    <div id="mList" class="m-grid"></div>
</div>

<div class="step-card s3">
    <h2><span class="badge">3</span> L·ªåC QU√Ä THEO ƒê·ªäNH M·ªÜNH (H·ªç T√™n & Gi√°)</h2>
    <div class="price-filters">
        <button class="p-btn" onclick="setPrice('L', 0, 50000, this)">L (D∆∞·ªõi 50k)</button>
        <button class="p-btn" onclick="setPrice('T', 50000, 200000, this)">T (50k - 200k)</button>
        <button class="p-btn" onclick="setPrice('D', 200000, 1000000, this)">D (200k - 1tr)</button>
        <button class="p-btn active" onclick="setPrice('C', 1000000, 99999999, this)">C (Tr√™n 1tr)</button>
    </div>
    <div id="productGallery">
        <table id="pTable">
            <thead>
                <tr>
                    <th>S·∫£n ph·∫©m</th>
                    <th>Gi√°</th>
                    <th>4. L·∫•y link g·ªëc</th>
                    <th>5. D√°n Link Affiliate</th>
                    <th>6. Vi·∫øt truy·ªán & ƒêƒÉng</th>
                </tr>
            </thead>
            <tbody id="pArea"></tbody>
        </table>
    </div>
</div>

<div class="step-card s4">
    <h2><span class="badge">L∆ØU √ù</span> ƒê·∫®Y H√ÄNG L√äN QU·∫¶Y (GITHUB)</h2>
    <p>B·∫•m n√∫t n√†y sau khi ƒë√£ d√°n xong c√°c link Affiliate ·ªü B∆∞·ªõc 5:</p>
    <button class="btn-action" style="background: var(--g); padding: 15px 30px; font-size: 16px;" onclick="exportJson()">üíæ XU·∫§T FILE "FILES.JSON" CHO GITHUB</button>
</div>

<script>
    const fixedMems = [
        {n:"NGUY·ªÑN KH·∫ÆC NƒÇNG", d:"1944-06-04", g:"Nam"}, {n:"T√î TH·ªä H√Ä", d:"1948-08-29", g:"N·ªØ"},
        {n:"NGUY·ªÑN MINH NAM", d:"1971-03-03", g:"Nam"}, {n:"TH√ÇN TH·ªä KIM ANH", d:"1981-09-23", g:"N·ªØ"},
        {n:"NGUY·ªÑN T√î NG√ÇN AN", d:"2014-09-28", g:"N·ªØ"}, {n:"NGUY·ªÑN T√î MINH CH√ÇU", d:"2016-07-25", g:"N·ªØ"},
        {n:"NGUY·ªÑN T√î B√çCH NG·ªåC", d:"2020-02-05", g:"N·ªØ"}, {n:"NGUY·ªÑN TH·ªä MINH H·∫∞NG", d:"1974-01-07", g:"N·ªØ"},
        {n:"NG√î QU√ù C∆Ø·ªúNG", d:"1973-05-23", g:"Nam"}, {n:"NG√î GIA B√ÅCH", d:"2000-10-12", g:"Nam"},
        {n:"NG√î GIA LINH", d:"2005-04-05", g:"N·ªØ"}, {n:"NGUY·ªÑN TH·ªä MINH PH∆Ø∆†NG", d:"1978-11-06", g:"N·ªØ"},
        {n:"HO√ÄNG ANH D≈®NG", d:"1978-09-21", g:"Nam"}, {n:"HO√ÄNG H·∫¢I VINH", d:"2010-06-03", g:"Nam"},
        {n:"HO√ÄNG THI√äN B·∫†CH ANH", d:"2015-11-14", g:"N·ªØ"}, {n:"T√î KIM HU·ªÜ", d:"1960-08-09", g:"N·ªØ"},
        {n:"NGUY·ªÑN TU·∫§N ANH", d:"1983-10-23", g:"Nam"}, {n:"NGUY·ªÑN TH·∫æ ANH", d:"2001-03-24", g:"Nam"},
        {n:"NG√î TH·ªä MAI", d:"1948-12-12", g:"N·ªØ"}, {n:"T√î VI·ªÜT H∆ØNG", d:"1996-06-17", g:"Nam"},
        {n:"T√î TH·ªä H·ªíNG", d:"1964-10-10", g:"N·ªØ"}, {n:"V≈® VƒÇN HI·ªÜP", d:"1974-04-24", g:"Nam"},
        {n:"NGUY·ªÑN TH·ªä CHI", d:"1946-02-08", g:"N·ªØ"}, {n:"NGUY·ªÑN T√ÇN B·∫ÆC", d:"1957-11-30", g:"Nam"},
        {n:"NGUY·ªÑN TH·ªä T√ÇM", d:"1954-08-08", g:"N·ªØ"}, {n:"TH√ÇN VƒÇN GI·ªÆ", d:"1955-04-18", g:"Nam"},
        {n:"NGUY·ªÑN TH·ªä B√åNH", d:"1958-05-21", g:"N·ªØ"}, {n:"TH√ÇN TH·ªä B√çCH NGUY·ªÜT", d:"1980-05-21", g:"N·ªØ"},
        {n:"TH√ÇN VƒÇN TU·∫§N", d:"1983-05-21", g:"Nam"}, {n:"TH√ÇN Y·∫æN NHI", d:"2010-03-26", g:"N·ªØ"},
        {n:"L√ä TH·ªä PH∆Ø∆†NG", d:"1990-06-26", g:"N·ªØ"}, {n:"NGUY·ªÑN HO√ÄI NAM", d:"2004-06-02", g:"Nam"}
    ];

    let warehouse = JSON.parse(localStorage.getItem('war_v18_3')) || [];
    let selM = null;
    let priceRange = { min: 1000000, max: 99999999 };
    const ghBase = "https://namnguyen7133-png.github.io/cua-hang-di-dong/001-kho-hang.html";

    // 1. X·ª≠ l√Ω CSV
    document.getElementById('csv').onchange = async (e) => {
        const files = Array.from(e.target.files);
        for (const file of files) {
            const text = await file.text();
            const lines = text.split('\n').slice(1);
            lines.forEach(l => {
                const c = l.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                if(c.length >= 5) {
                    const id = c[0].trim();
                    const url = c[c.length-1].trim().replace(/"/g, ''); // Gi·∫£ ƒë·ªãnh link shopee g·ªëc ·ªü c·ªôt cu·ªëi
                    if(!warehouse.some(x => x.id === id)) {
                        warehouse.push({ id, name: c[1].replace(/"/g, ''), price: parseInt(c[2].replace(/[^0-9]/g, '')), originalLink: url, linkAffiliate: "" });
                    }
                }
            });
        }
        localStorage.setItem('war_v18_3', JSON.stringify(warehouse));
        renderW();
    };

    // 2. Render danh s√°ch ng∆∞·ªùi
    function renderM() {
        const lucky = fixedMems[Math.floor((new Date() - new Date("2024-01-01"))/(1000*60*60*24)) % fixedMems.length];
        document.getElementById('mList').innerHTML = fixedMems.map(m => `
            <button class="m-btn ${selM?.n === m.n ? 'active' : ''} ${lucky.n === m.n ? 'lucky-border' : ''}" onclick='selectM(${JSON.stringify(m)})'>
                <b>${m.n}</b><br><small>${m.g} - ${m.d.split('-')[0]}</small>
            </button>
        `).join('');
    }

    function selectM(m) { selM = m; renderM(); renderW(); }

    // 3. L·ªçc theo gi√°
    function setPrice(type, min, max, btn) {
        priceRange = { min, max };
        document.querySelectorAll('.p-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        renderW();
    }

    // 4 & 5 & 6. Hi·ªÉn th·ªã b·∫£ng h√†ng
    function renderW() {
        if(!selM) return;
        const lastChar = selM.n.trim().slice(-1).toUpperCase();
        let pool = warehouse.filter(p => 
            p.name.trim().slice(-1).toUpperCase() === lastChar && 
            p.price >= priceRange.min && p.price <= priceRange.max
        );

        document.getElementById('pArea').innerHTML = pool.map(p => `
            <tr>
                <td><b>${p.name}</b></td>
                <td style="color:var(--p)">${p.price.toLocaleString()}ƒë</td>
                <td><button onclick="window.open('${p.originalLink}', '_blank')">üîó M·ªü Shopee G·ªëc</button></td>
                <td><input type="text" class="inp" placeholder="D√°n link r√∫t g·ªçn..." onchange="updateAff('${p.id}', this.value)" value="${p.linkAffiliate}"></td>
                <td>
                    <button class="btn-action" style="background:var(--gpt)" onclick="goAI('${p.id}')">‚úçÔ∏è Vi·∫øt Truy·ªán</button>
                </td>
            </tr>
        `).join('');
    }

    function updateAff(id, val) {
        const p = warehouse.find(x => x.id === id);
        if(p) p.linkAffiliate = val;
        localStorage.setItem('war_v18_3', JSON.stringify(warehouse));
    }

    function goAI(id) {
        const p = warehouse.find(x => x.id === id);
        const ghUrl = `${ghBase}?id=${p.id}`;
        let prompt = `Vi·∫øt m·ªôt c√¢u chuy·ªán ng·ª• ng√¥n ho·∫∑c h√†i h∆∞·ªõc ng·∫Øn k·ªÉ v·ªÅ vi·ªác: 
        Nh√¢n v·∫≠t ch√≠nh l√† ${selM.n} (${selM.g === 'Nam' ? '√¥ng/anh' : 'b√†/ch·ªã'}). 
        V√¨ c√≥ c√°i t√™n k·∫øt th√∫c b·∫±ng ch·ªØ "${selM.n.slice(-1)}" n√™n ƒë·ªãnh m·ªánh ƒë√£ ƒë∆∞a h·ªç ƒë·∫øn v·ªõi m√≥n qu√† "${p.name}".
        K·∫øt b√†i k√™u g·ªçi m·ªçi ng∆∞·ªùi v√†o link GitHub n√†y ƒë·ªÉ xem s·ª± t√≠ch v√† ·ªßng h·ªô con mua s·ªØa: ${ghUrl}.
        (D·∫∑n th√™m m·ªçi ng∆∞·ªùi d√πng m·∫°ng 4G ƒë·ªÉ h·ªá th·ªëng ghi nh·∫≠n ch√≠nh x√°c ·∫°)`;
        
        navigator.clipboard.writeText(prompt);
        alert("ƒê√£ copy truy·ªán! B·ªë sang AI d√°n v√†o v√† l·∫•y b√†i ƒëƒÉng Facebook k√®m ·∫£nh ng∆∞·ªùi th√¢n nh√©.");
        window.open("https://chatgpt.com", "_blank");
    }

    function exportJson() {
        const blob = new Blob([JSON.stringify(warehouse, null, 2)], {type: 'application/json'});
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'files.json'; a.click();
    }

    renderM();
</script>
</body>
</html>
