<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªçc Vi·ªán Marketing Gia ƒê√¨nh 2026</title>
    <style>
        :root { --p: #ee4d2d; --s: #1877F2; --v: #9b59b6; --g: #27ae60; --dark: #2d3436; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f2f5; margin: 0; padding: 15px; color: #333; }
        .container { max-width: 1100px; margin: auto; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        
        /* Step Guide Style */
        .step-card { background: #fff; border-left: 8px solid var(--dark); padding: 15px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .active-step { border-left-color: var(--p); background: #fffaf0; }
        .step-num { background: var(--dark); color: white; width: 25px; height: 25px; display: inline-flex; align-items: center; justify-content: center; border-radius: 50%; font-weight: bold; margin-right: 10px; }
        .active-step .step-num { background: var(--p); }
        
        /* Table Style */
        .table-wrap { overflow-x: auto; margin-top: 15px; border-radius: 10px; border: 1px solid #eee; }
        table { width: 100%; border-collapse: collapse; min-width: 800px; }
        th { background: var(--dark); color: white; padding: 12px; font-size: 13px; text-align: center; }
        td { padding: 12px; border-bottom: 1px solid #eee; vertical-align: middle; }
        
        /* Input & Buttons */
        .edit-name { width: 95%; padding: 8px; border: 2px solid #ddd; border-radius: 6px; font-weight: bold; color: var(--s); }
        .aff-link { width: 95%; padding: 8px; border: 2px solid #ff7675; border-radius: 6px; font-size: 11px; margin-top: 5px; background: #fff5f5; }
        .btn { border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; color: white; font-weight: bold; font-size: 11px; transition: 0.2s; }
        .btn:hover { opacity: 0.8; transform: scale(1.02); }
        .btn-get { background: #636e72; margin-bottom: 5px; width: 100%; }
        .btn-ai { background: var(--v); width: 100%; margin-bottom: 3px; }
        
        .img-box { width: 65px; height: 65px; border: 2px dashed #ccc; border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; overflow: hidden; margin: auto; }
        .img-box img { width: 100%; height: 100%; object-fit: cover; }
        .done-row { opacity: 0.5; background: #f8f9fa !important; }
    </style>
</head>
<body>

<div class="container">
    <h1 style="text-align: center; color: var(--p); margin-top: 0;">üöÄ H·ªÜ TH·ªêNG MARKETING GIA ƒê√åNH</h1>

    <div class="step-card active-step" id="step1">
        <span class="step-num">1</span> <strong>B·ªê N·∫†P H√ÄNG:</strong> 
        <input type="file" id="csvInp" multiple accept=".csv" style="margin-left:10px" onclick="setStep(1)">
        <p style="font-size: 11px; margin: 5px 0 0 35px; color: #666;">(B·ªë c√≥ th·ªÉ ch·ªçn 10 file CSV Shopee c√πng l√∫c. H·ªá th·ªëng s·∫Ω t·ª± l·ªçc tr√πng)</p>
    </div>

    <div class="step-card" id="step2">
        <span class="step-num">2</span> <strong>PH·ªêI H·ª¢P: B·ªë d√°n Link - B√© s·ª≠a T√™n & ·∫¢nh</strong>
        <div class="table-wrap">
            <table>
                <thead>
                    <tr>
                        <th width="80">·∫¢nh</th>
                        <th>B√© s·ª≠a T√™n (H·ªçc t·ª´ v·ª±ng)</th>
                        <th width="220">B·ªë d√°n Link Affiliate</th>
                        <th width="150">K·ªÉ chuy·ªán AI</th>
                        <th width="50">Xong</th>
                    </tr>
                </thead>
                <tbody id="mainTable">
                    <tr><td colspan="5" style="text-align:center; padding: 30px; color:#999">ƒêang ch·ªù n·∫°p CSV...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="step-card" id="step3">
        <span class="step-num">3</span> <strong>K·∫æT TH√öC: B√°o c√°o & L∆∞u tr·ªØ</strong>
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <button class="btn" style="background:var(--v)" onclick="showReport()">üìä Xem B√°o C√°o Ng√†y</button>
            <button class="btn" style="background:var(--g)" onclick="exportStorage()">üíæ L∆∞u Kho D·ª± Ph√≤ng</button>
            <button class="btn" style="background:var(--dark)" onclick="clearAll()">üóëÔ∏è X√≥a Kho (L√†m m·ªõi)</button>
        </div>
    </div>
</div>

<script>
    let warehouse = JSON.parse(localStorage.getItem('eduWarehouse_v2') || '[]');
    let jobsCount = parseInt(localStorage.getItem('todayJobs') || '0');

    // T·ª± ƒë·ªông d·ªçn r√°c b·ªô nh·ªõ n·∫øu qu√° ƒë·∫ßy
    function setStep(n) {
        document.querySelectorAll('.step-card').forEach((el, idx) => {
            el.classList.toggle('active-step', (idx + 1) === n);
        });
    }

    // N·∫°p CSV
    document.getElementById('csvInp').onchange = async (e) => {
        const files = Array.from(e.target.files);
        for (const file of files) {
            const text = await file.text();
            const lines = text.split('\n').slice(1);
            lines.forEach(l => {
                const c = l.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                if(c.length >= 8) {
                    const id = c[0].trim();
                    if(!warehouse.some(p => p.id === id)) {
                        const raw = c[1]?.replace(/"/g, '') || "";
                        warehouse.push({
                            id: id, raw: raw,
                            name: raw.replace(/\[.*?\]|\(.*?\)/g, '').split(' ').slice(0, 5).join(' ').trim(),
                            l: c[8]?.trim() || c[7]?.trim(),
                            img: '', done: false
                        });
                    }
                }
            });
        }
        save();
        setStep(2);
    };

    function updateVal(id, key, val) {
        const idx = warehouse.findIndex(p => p.id === id);
        warehouse[idx][key] = val;
        localStorage.setItem('eduWarehouse_v2', JSON.stringify(warehouse));
    }

    function save() {
        localStorage.setItem('eduWarehouse_v2', JSON.stringify(warehouse));
        render();
    }

    function render() {
        const tbody = document.getElementById('mainTable');
        if(warehouse.length === 0) return;
        
        // Ch·ªâ hi·ªán 30 m√≥n m·ªõi nh·∫•t ƒë·ªÉ tr√°nh lag m√°y
        tbody.innerHTML = warehouse.slice(-30).reverse().map(p => `
            <tr class="${p.done ? 'done-row' : ''}">
                <td>
                    <div class="img-box" onclick="uploadImg('${p.id}')">
                        ${p.img ? `<img src="${p.img}">` : '<span style="font-size:20px">+</span>'}
                    </div>
                </td>
                <td style="text-align:left">
                    <input type="text" class="edit-name" value="${p.name}" onchange="updateVal('${p.id}', 'name', this.value)">
                    <small style="display:block; font-size:9px; color:#999; margin-top:4px">G·ªëc: ${p.raw.substring(0,45)}...</small>
                </td>
                <td>
                    <button class="btn btn-get" onclick="window.open('${p.l}', '_blank')">üîó 1. M·ªü Link G·ªëc</button>
                    <input type="text" class="aff-link" value="${p.l.includes('shopee.vn/product') ? '' : p.l}" 
                        onchange="updateVal('${p.id}', 'l', this.value)" placeholder="2. D√°n link r√∫t g·ªçn...">
                </td>
                <td>
                    <button class="btn btn-ai" onclick="askAI('Ng·ª• ng√¥n', '${p.id}')">üé≠ Ng·ª• ng√¥n</button>
                    <button class="btn btn-ai" style="background:var(--s)" onclick="askAI('C·ªï t√≠ch', '${p.id}')">üßö C·ªï t√≠ch</button>
                </td>
                <td>
                    <input type="checkbox" ${p.done ? 'checked' : ''} onclick="toggleDone('${p.id}')">
                </td>
            </tr>
        `).join('');
    }

    function uploadImg(id) {
        const inp = document.createElement('input');
        inp.type = 'file'; inp.accept = 'image/*';
        inp.onchange = (e) => {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = (ev) => {
                const img = new Image();
                img.onload = () => {
                    const cvs = document.createElement('canvas');
                    cvs.width = 150; cvs.height = 150; // N√©n ·∫£nh nh·ªè tr√°nh treo m√°y
                    cvs.getContext('2d').drawImage(img, 0, 0, 150, 150);
                    const idx = warehouse.findIndex(p => p.id === id);
                    warehouse[idx].img = cvs.toDataURL('image/jpeg', 0.7);
                    jobsCount++;
                    localStorage.setItem('todayJobs', jobsCount);
                    save();
                };
                img.src = ev.target.result;
            };
            reader.readAsDataURL(file);
        };
        inp.click();
    }

    function askAI(style, id) {
        const p = warehouse.find(x => x.id === id);
        if(!p.l.includes('s.shopee') && !p.l.includes('shope.ee')) {
            alert("‚ö†Ô∏è B·ªë ch∆∞a d√°n Link Affiliate r√∫t g·ªçn cho m√≥n n√†y ƒë√¢u b√© ∆°i!");
            return;
        }
        const prompt = `Vi·∫øt m·ªôt c√¢u chuy·ªán ${style} ng·∫Øn (150 ch·ªØ) h√†i h∆∞·ªõc. Nh√¢n v·∫≠t ch√≠nh l√† m·ªôt ng∆∞·ªùi b·∫°n. V·∫≠t ph·∫©m quan tr·ªçng trong truy·ªán l√†: "${p.name}". H√£y l·ªìng gh√©p c√¥ng d·ª•ng c·ªßa n√≥ th·∫≠t d√≠ d·ªèm. K·∫øt b√†i b·∫±ng l·ªùi kh√™u g·ª£i mua h√†ng k√®m link: ${p.l}`;
        
        navigator.clipboard.writeText(prompt);
        jobsCount++;
        localStorage.setItem('todayJobs', jobsCount);
        alert(`‚ú® B√© ƒë√£ ƒë·∫∑t t√™n: "${p.name}" r·∫•t t·ªët!\nüöÄ ƒê√£ copy l·ªánh cho AI. B√© sang DeepSeek d√°n v√†o nh√©!`);
        window.open('https://chat.deepseek.com', '_blank');
        setStep(3);
    }

    function toggleDone(id) {
        const idx = warehouse.findIndex(p => p.id === id);
        warehouse[idx].done = !warehouse[idx].done;
        save();
    }

    function showReport() {
        const doneCount = warehouse.filter(p => p.done).length;
        alert(`üìä B√ÅO C√ÅO C√îNG VI·ªÜC:\n- T·ªïng h√†ng trong kho: ${warehouse.length}\n- S·ªë m√≥n ƒë√£ ho√†n th√†nh: ${doneCount}\n- T·ªïng thao t√°c s√°ng t·∫°o h√¥m nay: ${jobsCount}\n\nüåü C·∫£ nh√† l√†m t·ªët l·∫Øm!`);
    }

    function exportStorage() {
        const blob = new Blob([JSON.stringify(warehouse)], {type:'application/json'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `kho_gia_dinh_${new Date().toLocaleDateString().replace(/\//g,'-')}.json`;
        a.click();
    }

    function clearAll() {
        if(confirm("X√≥a s·∫°ch kho ƒë·ªÉ n·∫°p h√†ng m·ªõi nh√©? H√£y nh·ªõ L∆∞u D·ª± Ph√≤ng tr∆∞·ªõc!")) {
            warehouse = [];
            localStorage.clear();
            location.reload();
        }
    }

    render();
</script>
</body>
</html>
