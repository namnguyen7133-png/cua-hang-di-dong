<script>
// ===== Dá»® LIá»†U Dá»° PHÃ’NG =====
const defaultProducts = [];

// ===== ADMIN =====
function checkAdmin(){
  const p=new URLSearchParams(location.search);
  if(p.get("admin")==="true"){
    localStorage.setItem("is_admin","1");
  }
  if(localStorage.getItem("is_admin")){
    document.getElementById("admin-panel").style.display="block";
    document.getElementById("shop-title").innerText="ðŸ‘¨â€ðŸ’» QUáº¢N LÃ KHO";
  }
}

// ===== LOAD + Lá»ŒC THEO TRáºº =====
async function initStore(){
  checkAdmin();

  const params = new URLSearchParams(location.search);
  const tre = params.get("tre") || "all";

  let products = [];

  try{
    const res = await fetch("./files.json?nocache=" + Date.now());
    const data = await res.json();
    if(data.products && data.products.length){
      products = data.products;
    }
  }catch(e){
    const local = localStorage.getItem("shopee_kho_tong");
    if(local) products = JSON.parse(local);
  }

  // ===== Lá»ŒC THEO CON =====
  if(tre !== "all"){
    products = products.filter(p => !p.tre || p.tre == tre);
  }

  render(products);
}

// ===== RENDER =====
function render(list){
  const box=document.getElementById("product-container");

  if(!list || !list.length){
    box.innerHTML="<p style='grid-column:span 2;text-align:center'>ChÆ°a cÃ³ sáº£n pháº©m</p>";
    return;
  }

  box.innerHTML=list.map(i=>`
    <div class="product-card">
      <img src="${i.img||''}" onerror="this.src='https://via.placeholder.com/300'">
      <strong>${i.name||''}</strong>
      <p>${i.desc||''}</p>
      <div class="price-tag">${i.price||''}</div>
      <a class="btn" target="_blank" href="${i.link||'#'}">MUA NGAY</a>
    </div>
  `).join("");
}

// ===== ADMIN ACTION =====
function importData(){
  try{
    const d=JSON.parse(jsonInput.value);
    localStorage.setItem("shopee_kho_tong",JSON.stringify(d.products||d));
    location.reload();
  }catch{
    alert("JSON sai Ä‘á»‹nh dáº¡ng");
  }
}
function clearStore(){
  localStorage.removeItem("shopee_kho_tong");
  location.reload();
}

window.onload=initStore;
</script>
