<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>H·ªá Th·ªëng Marketing Th√¥ng Minh - Logic T·∫ßng Gi√°</title>
    <style>
        :root { --p: #ee4d2d; --s: #1877F2; --v: #9b59b6; --g: #27ae60; --dark: #2d3436; }
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; padding: 20px; margin: 0; }
        .box { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 15px; }
        h2 { color: var(--p); border-bottom: 2px solid #eee; padding-bottom: 8px; margin-top: 0; font-size: 18px; }
        
        /* Member */
        .member-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 8px; max-height: 180px; overflow-y: auto; padding: 10px; background: #f9f9f9; border-radius: 8px; }
        .m-btn { padding: 8px; border: 1px solid #ddd; border-radius: 6px; cursor: pointer; background: #fff; font-size: 11px; text-align: left; }
        .m-btn.active { background: var(--v); color: white; font-weight: bold; border-color: var(--v); }

        /* B·ªô l·ªçc t·∫ßng gi√° */
        .filter-group { display: flex; gap: 5px; flex-wrap: wrap; margin-bottom: 10px; background: #fff3bf; padding: 10px; border-radius: 8px; }
        .f-btn { border: none; padding: 6px 12px; border-radius: 20px; cursor: pointer; background: white; border: 1px solid #fab005; font-size: 11px; font-weight: bold; }
        .f-btn.active { background: #fab005; color: white; }

        /* Table */
        .table-container { max-height: 350px; overflow-y: auto; border: 1px solid #eee; }
        table { width: 100%; border-collapse: collapse; font-size: 12px; }
        th { background: var(--dark); color: white; padding: 10px; position: sticky; top: 0; }
        td { border-bottom: 1px solid #eee; padding: 8px; text-align: center; }
        
        .btn-ai { font-size: 10px; margin: 2px; width: 75px; padding: 5px; border-radius: 4px; border: none; color: white; cursor: pointer; }
        .status { background: var(--g); color: white; padding: 8px; border-radius: 6px; text-align: center; font-weight: bold; margin-bottom: 10px; font-size: 13px; }
    </style>
</head>
<body>

<div style="max-width: 1100px; margin: auto;">
    <div class="box">
        <h2>1. CH·ªåN NG∆Ø·ªúI TH√ÇN</h2>
        <div class="member-grid" id="mList"></div>
    </div>

    <div class="box">
        <div id="status" class="status">üëâ B∆Ø·ªöC 1: H√ÉY CH·ªåN M·ªòT NG∆Ø·ªúI!</div>
        
        <h2>2. B·ªò L·ªåC T·∫¶NG GI√Å & LOGIC T√äN</h2>
        <div class="filter-group">
            <span style="font-size:12px; width:100%; margin-bottom:5px;"><b>L·ªçc theo gi√°:</b></span>
            <button class="f-btn active" onclick="setPriceFilter(0, 999999999, this)">T·∫•t c·∫£</button>
            <button class="f-btn" onclick="setPriceFilter(0, 9000, this)">D∆∞·ªõi 9k</button>
            <button class="f-btn" onclick="setPriceFilter(0, 20000, this)">D∆∞·ªõi 20k</button>
            <button class="f-btn" onclick="setPriceFilter(0, 50000, this)">D∆∞·ªõi 50k</button>
            <button class="f-btn" onclick="setPriceFilter(0, 100000, this)">D∆∞·ªõi 100k</button>
            <button class="f-btn" onclick="setPriceFilter(0, 200000, this)">D∆∞·ªõi 200k</button>
            <button class="f-btn" onclick="setPriceFilter(0, 1000000, this)">D∆∞·ªõi 1tr</button>
        </div>

        <div style="margin-bottom: 10px; display: flex; gap: 10px;">
            <input type="file" id="csv" multiple accept=".csv" style="font-size: 11px;">
            <input type="text" id="search" placeholder="üîç T√¨m t√™n s·∫£n ph·∫©m..." oninput="renderW()" style="flex:1; padding:5px; border-radius:5px; border:1px solid #ddd;">
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>T√™n S·∫£n Ph·∫©m</th>
                        <th width="80">Gi√° (k)</th>
                        <th width="180">AI (T·ª± copy l·ªánh)</th>
                        <th width="40">X√≥a</th>
                    </tr>
                </thead>
                <tbody id="pArea"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    const fixedMems = [
        {n:"NGUY·ªÑN KH·∫ÆC NƒÇNG", d:"1944-06-04", g:"Nam"}, {n:"T√î TH·ªä H√Ä", d:"1948-08-29", g:"N·ªØ"},
        {n:"NGUY·ªÑN MINH NAM", d:"1971-03-03", g:"Nam"}, {n:"TH√ÇN TH·ªä KIM ANH", d:"1981-09-23", g:"N·ªØ"},
        {n:"NGUY·ªÑN T√î NG√ÇN AN", d:"2014-09-28", g:"N·ªØ"}, {n:"NGUY·ªÑN T√î MINH CH√ÇU", d:"2016-07-25", g:"N·ªØ"},
        {n:"NGUY·ªÑN T√î B√çCH NG·ªåC", d:"2020-02-05", g:"N·ªØ"}, {n:"NGUY·ªÑN TH·ªä MINH H·∫∞NG", d:"1974-01-07", g:"N·ªØ"},
        {n:"NG√î QU√ù C∆Ø·ªúNG", d:"1973-05-23", g:"Nam"}, {n:"NG√î GIA B√ÅCH", d:"2000-10-12", g:"Nam"},
        {n:"NG√î GIA LINH", d:"2005-04-05", g:"N·ªØ"}, {n:"NGUY·ªÑN TH·ªä MINH PH∆Ø∆†NG", d:"1978-11-06", g:"N·ªØ"},
        {n:"HO√ÄNG ANH D≈®NG", d:"1978-09-21", g:"Nam"}, {n:"HO√ÄNG H·∫¢I VINH", d:"2010-06-03", g:"Nam"},
        {n:"HO√ÄNG THI√äN B·∫†CH ANH", d:"2015-11-14", g:"N·ªØ"}, {n:"T√î KIM HU·ªÜ", d:"1960-08-09", g:"N·ªØ"},
        {n:"NGUY·ªÑN TU·∫§N ANH", d:"1983-10-23", g:"Nam"}, {n:"NGUY·ªÑN TH·∫æ ANH", d:"2001-03-24", g:"Nam"},
        {n:"NG√î TH·ªä MAI", d:"1948-12-12", g:"N·ªØ"}, {n:"T√î VI·ªÜT H∆ØNG", d:"1996-06-17", g:"Nam"},
        {n:"T√î TH·ªä H·ªíNG", d:"1964-10-10", g:"N·ªØ"}, {n:"V≈® VƒÇN HI·ªÜP", d:"1974-04-24", g:"Nam"},
        {n:"NGUY·ªÑN TH·ªä CHI", d:"1946-02-08", g:"N·ªØ"}, {n:"NGUY·ªÑN T√ÇN B·∫ÆC", d:"1957-11-30", g:"Nam"},
        {n:"NGUY·ªÑN TH·ªä T√ÇM", d:"1954-08-08", g:"N·ªØ"}, {n:"TH√ÇN VƒÇN GI·ªÆ", d:"1955-04-18", g:"Nam"},
        {n:"NGUY·ªÑN TH·ªä B√åNH", d:"1958-05-21", g:"N·ªØ"}, {n:"TH√ÇN TH·ªä B√çCH NGUY·ªÜT", d:"1980-05-21", g:"N·ªØ"},
        {n:"TH√ÇN VƒÇN TU·∫§N", d:"1983-05-21", g:"Nam"}, {n:"TH√ÇN Y·∫æN NHI", d:"2010-03-26", g:"N·ªØ"},
        {n:"L√ä TH·ªä PH∆Ø∆†NG", d:"1990-06-26", g:"N·ªØ"}, {n:"NGUY·ªÑN HO√ÄI NAM", d:"2004-06-02", g:"Nam"}
    ];

    let warehouse = JSON.parse(localStorage.getItem('ware_v8')) || [];
    let selM = null;
    let priceRange = { min: 0, max: 999999999 };

    function renderM() {
        document.getElementById('mList').innerHTML = fixedMems.map(m => `
            <button class="m-btn ${selM?.n === m.n ? 'active' : ''}" onclick='selectM(${JSON.stringify(m)})'>
                ${m.n}
            </button>
        `).join('');
    }

    function selectM(m) {
        selM = m;
        selM.age = Math.floor((new Date() - new Date(m.d))/31557600000);
        // Logic ch·ªçn s·ªë l∆∞·ª£ng: L·∫•y ƒë·ªô d√†i ch·ªØ cu·ªëi (v√≠ d·ª• "Ch√¢u" = 4) * 5 ho·∫∑c s·ªë b·∫•t k·ª≥
        const lastName = m.n.split(' ').pop();
        const countLimit = lastName.length * 7; // V√≠ d·ª• Ch√¢u (4 ch·ªØ) -> hi·ªán 28 SP
        
        document.getElementById('status').innerText = `‚úÖ CH·ªåN: ${m.n} | G·ª£i √Ω t·∫ßng: ${countLimit} SP theo t√™n "${lastName}"`;
        renderM();
        renderW(countLimit);
    }

    function setPriceFilter(min, max, btn) {
        priceRange = { min, max };
        document.querySelectorAll('.f-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        renderW();
    }

    document.getElementById('csv').onchange = async (e) => {
        const files = Array.from(e.target.files);
        for (const file of files) {
            const text = await file.text();
            const lines = text.split('\n').slice(1);
            lines.forEach(l => {
                const c = l.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                if(c.length >= 5) {
                    const id = c[0].trim();
                    const price = parseFloat(c[2]?.replace(/[^0-9]/g, '')) || 0;
                    if(!warehouse.some(p => p.id === id)) {
                        warehouse.push({ id, n: c[1]?.replace(/"/g, '').split(' ').slice(0, 6).join(' ').trim(), p: price });
                    }
                }
            });
        }
        localStorage.setItem('ware_v8', JSON.stringify(warehouse));
        renderW();
    };

    function renderW(limit = 100) {
        const area = document.getElementById('pArea');
        const search = document.getElementById('search').value.toLowerCase();
        
        let filtered = warehouse.filter(p => 
            p.n.toLowerCase().includes(search) && 
            p.p >= priceRange.min && p.p <= priceRange.max
        );

        // √Åp d·ª•ng limit n·∫øu c√≥ ng∆∞·ªùi ƒë∆∞·ª£c ch·ªçn
        if(selM) filtered = filtered.slice(0, limit);

        area.innerHTML = filtered.map(p => `
            <tr>
                <td style="text-align:left">${p.n}</td>
                <td>${(p.p/1000).toFixed(0)}k</td>
                <td>
                    <button class="btn-ai" style="background:var(--v)" onclick="goAI('DeepSeek','${p.id}')">DeepSeek</button>
                    <button class="btn-ai" style="background:var(--s)" onclick="goAI('Gemini','${p.id}')">Gemini</button>
                </td>
                <td><button onclick="delP('${p.id}')">‚ùå</button></td>
            </tr>
        `).join('');
    }

    function goAI(ai, id) {
        if(!selM) return alert("Ch·ªçn ng∆∞·ªùi tr∆∞·ªõc b·ªë ∆°i!");
        const p = warehouse.find(x => x.id === id);
        const link = `https://namnguyen7133-png.github.io/cua-hang-di-dong/001-kho-hang.html?id=${id}`;
        
        let prompt = "";
        if(selM.age < 13) {
            prompt = `H√£y vi·∫øt m·ªôt c√¢u chuy·ªán ng·ª• ng√¥n h√†i h∆∞·ªõc v·ªÅ m√≥n ƒë·ªì ${p.n} cho b√© ${selM.n} (${selM.age} tu·ªïi). Cu·ªëi b√†i ghi link: ${link}`;
        } else {
            prompt = `Vi·∫øt b√†i ƒëƒÉng Facebook h√†i h∆∞·ªõc cho ${selM.n} (${selM.age} tu·ªïi) v·ªÅ m√≥n ${p.n}. Link xem: ${link}`;
        }

        navigator.clipboard.writeText(prompt).then(() => {
            alert("ƒê√£ copy l·ªánh AI!");
            window.open(ai === 'DeepSeek' ? "https://chat.deepseek.com" : "https://gemini.google.com/app", "_blank");
        });
    }

    function delP(id) { warehouse = warehouse.filter(x => x.id !== id); localStorage.setItem('ware_v8', JSON.stringify(warehouse)); renderW(); }

    renderM();
    renderW();
</script>
</body>
</html>
