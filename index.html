<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>B·∫£n ƒê·ªì Marketing 6 B∆∞·ªõc - V18.7</title>
    <style>
        :root { --step-bg: #ffffff; --text: #2d3436; --accent: #ff4757; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: #f1f2f6; padding: 20px; color: var(--text); }
        
        /* B·∫¢NG CH·ªà D·∫™N S·ªê */
        .step-box { background: white; border-radius: 15px; padding: 20px; margin-bottom: 20px; border-left: 10px solid #ccc; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .s1 { border-color: #ff9f43; } .s2 { border-color: #00d2d3; } .s3 { border-color: #54a0ff; }
        .s4 { border-color: #5f27cd; } .s5 { border-color: #ff4757; } .s6 { border-color: #1dd1a1; }

        .step-num { background: var(--text); color: white; padding: 5px 15px; border-radius: 50px; font-weight: bold; margin-right: 10px; }
        
        /* SI√äU TH·ªä ·∫¢NH */
        .market-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; }
        .product-card { background: white; border-radius: 12px; overflow: hidden; border: 2px solid #eee; cursor: pointer; transition: 0.3s; }
        .product-card:hover { border-color: var(--accent); transform: scale(1.02); }
        .product-img { width: 100%; height: 180px; object-fit: cover; background: #fafafa; }
        .product-name { padding: 10px; font-size: 14px; font-weight: bold; height: 40px; overflow: hidden; }
        .highlight { color: red; font-size: 20px; text-decoration: underline; font-weight: 900; }

        /* MODAL ƒêI·ªÄU KHI·ªÇN */
        #controlModal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:1000; }
        .modal-content { background: white; width: 90%; max-width: 500px; margin: 50px auto; padding: 25px; border-radius: 20px; text-align: center; }
        
        .btn { padding: 12px 20px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; margin: 5px; color: white; }
        .btn-shopee { background: #ee4d2d; width: 100%; font-size: 18px; }
        .btn-ai { font-size: 12px; width: 45%; }
        .btn-git { background: #2f3542; width: 100%; margin-top: 20px; font-size: 18px; }
        
        .big-input { width: 100%; padding: 15px; border: 2px solid #54a0ff; border-radius: 10px; margin: 10px 0; box-sizing: border-box; font-size: 16px; }
    </style>
</head>
<body>

<h1 style="text-align:center">üó∫Ô∏è B·∫¢N ƒê·ªí MARKETING C·ª¶A 3 ANH EM</h1>

<div class="step-box s1">
    <h2><span class="step-num">1</span> N·∫†P FILE H√ÄNG (CSV)</h2>
    <input type="file" id="csv" multiple accept=".csv" style="width:100%">
</div>

<div class="step-box s2">
    <h2><span class="step-num">2</span> NG∆Ø·ªúI MAY M·∫ÆN H√îM NAY</h2>
    <div id="luckyName" style="font-size: 30px; font-weight: bold; color: #5f27cd;">ƒêang ch·ªù n·∫°p file...</div>
</div>

<div class="step-box s3">
    <h2><span class="step-num">3</span> CH·ªåN QU√Ä C√ì CH·ªÆ CU·ªêI GI·ªêNG T√äN</h2>
    <div style="margin-bottom:10px">
        T·∫ßng gi√°: 
        <button onclick="renderMarket(0,50000)">L</button>
        <button onclick="renderMarket(50000,200000)">T</button>
        <button onclick="renderMarket(200000,1000000)">D</button>
        <button onclick="renderMarket(1000000,99999999)">C</button>
    </div>
    <div id="market" class="market-grid"></div>
</div>

<div id="controlModal">
    <div class="modal-content">
        <img id="modalImg" style="width:150px; border-radius:10px; margin-bottom:10px">
        <h3 id="modalName"></h3>
        
        <div style="background: #fff4f4; padding: 10px; border-radius: 10px; margin-bottom: 15px;">
            <p><b><span class="step-num">4</span> L·∫§Y LINK G·ªêC</b></p>
            <button class="btn btn-shopee" onclick="openShopee()">M·ªû SHOPEE ƒê·ªÇ R√öT G·ªåN LINK</button>
            <p style="font-size:11px">Khi b·∫•m n√∫t tr√™n, m√°y ƒë√£ t·ª± copy link g·ªëc cho b√© r·ªìi!</p>
        </div>

        <div style="background: #f0f7ff; padding: 10px; border-radius: 10px;">
            <p><b><span class="step-num">5</span> D√ÅN LINK R√öT G·ªåN</b></p>
            <input type="text" id="affInput" class="big-input" placeholder="D√°n link m√†u xanh v√†o ƒë√¢y...">
            <p style="font-size:11px">D√°n xong th√¨ ch·ªçn 1 ph√π th·ªßy AI d∆∞·ªõi ƒë√¢y ƒë·ªÉ vi·∫øt b√†i:</p>
            <div style="display: flex; flex-wrap: wrap; justify-content: center;">
                <button class="btn btn-ai" style="background:#10a37f" onclick="goAI('chatgpt')">ChatGPT</button>
                <button class="btn btn-ai" style="background:#4285f4" onclick="goAI('gemini')">Gemini</button>
                <button class="btn btn-ai" style="background:#000" onclick="goAI('grok')">Grok</button>
                <button class="btn btn-ai" style="background:#6a1b9a" onclick="goAI('deepseek')">DeepSeek</button>
            </div>
        </div>
        
        <button onclick="closeModal()" style="margin-top:20px; background:none; border:none; text-decoration:underline; cursor:pointer">Quay l·∫°i ch·ªçn m√≥n kh√°c</button>
    </div>
</div>

<div class="step-box s6">
    <h2><span class="step-num">6</span> XU·∫§T B·∫¢N & ƒêƒÇNG B√ÄI</h2>
    <button class="btn btn-git" onclick="exportJson()">üíæ XU·∫§T FILE CHO GITHUB</button>
    <p style="text-align:center; font-size:12px; margin-top:10px">Link GitHub ƒë·ªÉ d√°n v√†o Facebook:<br><b id="finalLink" style="color:blue">---</b></p>
</div>

<script>
    const fixedMems = [
        {n:"NGUY·ªÑN KH·∫ÆC NƒÇNG", d:"1944-06-04", g:"Nam"}, {n:"T√î TH·ªä H√Ä", d:"1948-08-29", g:"N·ªØ"},
        {n:"NGUY·ªÑN MINH NAM", d:"1971-03-03", g:"Nam"}, {n:"TH√ÇN TH·ªä KIM ANH", d:"1981-09-23", g:"N·ªØ"},
        {n:"NGUY·ªÑN T√î NG√ÇN AN", d:"2014-09-28", g:"N·ªØ"}, {n:"NGUY·ªÑN T√î MINH CH√ÇU", d:"2016-07-25", g:"N·ªØ"},
        {n:"NGUY·ªÑN T√î B√çCH NG·ªåC", d:"2020-02-05", g:"N·ªØ"}, {n:"NGUY·ªÑN TH·ªä MINH H·∫∞NG", d:"1974-01-07", g:"N·ªØ"},
        {n:"NG√î QU√ù C∆Ø·ªúNG", d:"1973-05-23", g:"Nam"}, {n:"NG√î GIA B√ÅCH", d:"2000-10-12", g:"Nam"},
        {n:"NG√î GIA LINH", d:"2005-04-05", g:"N·ªØ"}, {n:"NGUY·ªÑN TH·ªä MINH PH∆Ø∆†NG", d:"1978-11-06", g:"N·ªØ"},
        {n:"HO√ÄNG ANH D≈®NG", d:"1978-09-21", g:"Nam"}, {n:"HO√ÄNG H·∫¢I VINH", d:"2010-06-03", g:"Nam"},
        {n:"HO√ÄNG THI√äN B·∫†CH ANH", d:"2015-11-14", g:"N·ªØ"}, {n:"T√î KIM HU·ªÜ", d:"1960-08-09", g:"N·ªØ"}
    ];

    let warehouse = JSON.parse(localStorage.getItem('war_v18_7')) || [];
    let lucky = null;
    let selected = null;

    // T·ª± ƒë·ªông ch·ªçn ng∆∞·ªùi theo ng√†y
    function getLucky() {
        const offset = Math.floor((new Date() - new Date("2026-01-01")) / (1000*60*60*24));
        lucky = fixedMems[offset % fixedMems.length];
        const lastChar = lucky.n.trim().slice(-1);
        document.getElementById('luckyName').innerHTML = lucky.n.slice(0,-1) + `<span style="background:yellow; padding:2px 10px; border-radius:5px">${lastChar}</span>`;
    }

    // ƒê·ªçc CSV v√† t√¨m ·∫£nh
    document.getElementById('csv').onchange = async (e) => {
        const files = Array.from(e.target.files);
        for (const file of files) {
            const text = await file.text();
            const lines = text.split('\n').slice(1);
            lines.forEach(l => {
                const c = l.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                if(c.length >= 4) {
                    const id = c[0].trim();
                    if(!warehouse.some(x => x.id === id)) {
                        warehouse.push({
                            id: id,
                            name: c[1].replace(/"/g, ''),
                            price: parseInt(c[2].replace(/[^0-9]/g, '')),
                            img: c[3]?.replace(/"/g, '') || 'https://via.placeholder.com/200', // C·ªôt 4 l√† ·∫£nh
                            link: c[c.length-1].replace(/"/g, '').trim()
                        });
                    }
                }
            });
        }
        localStorage.setItem('war_v18_7', JSON.stringify(warehouse));
        renderMarket(0, 99999999);
    };

    // Hi·ªán si√™u th·ªã ·∫£nh
    function renderMarket(min, max) {
        const area = document.getElementById('market');
        area.innerHTML = "";
        const char = lucky.n.trim().slice(-1).toUpperCase();
        
        warehouse.filter(p => p.price >= min && p.price <= max).forEach(p => {
            const pChar = p.name.trim().slice(-1).toUpperCase();
            const isMatch = pChar === char;
            const card = document.createElement('div');
            card.className = 'product-card';
            card.onclick = () => openControl(p);
            card.innerHTML = `
                <img src="${p.img}" class="product-img">
                <div class="product-name">${p.name.slice(0,-1)}<span class="${isMatch?'highlight':''}">${p.name.slice(-1)}</span></div>
                <div style="padding:10px; color:red; font-weight:bold">${p.price.toLocaleString()}ƒë</div>
            `;
            area.appendChild(card);
        });
    }

    function openControl(p) {
        selected = p;
        document.getElementById('modalImg').src = p.img;
        document.getElementById('modalName').innerText = p.name;
        document.getElementById('controlModal').style.display = 'block';
        navigator.clipboard.writeText(p.link); // T·ª± copy link g·ªëc
    }

    function openShopee() {
        window.open('https://affiliate.shopee.vn/offer/custom_link', '_blank');
    }

    function closeModal() {
        document.getElementById('controlModal').style.display = 'none';
    }

    function goAI(type) {
        const aff = document.getElementById('affInput').value;
        if(!aff) return alert("D√°n link r√∫t g·ªçn v√†o ƒë√£!");
        
        // L∆∞u link aff v√†o s·∫£n ph·∫©m
        const item = warehouse.find(x => x.id === selected.id);
        item.aff = aff;
        localStorage.setItem('war_v18_7', JSON.stringify(warehouse));

        const ghUrl = `https://namnguyen7133-png.github.io/cua-hang-di-dong/001-kho-hang.html?id=${selected.id}`;
        document.getElementById('finalLink').innerText = ghUrl;

        const prompt = `Vi·∫øt m·ªôt c√¢u chuy·ªán ng·ª• ng√¥n h√†i h∆∞·ªõc v·ªÅ ${lucky.n} (${lucky.g}). V√¨ duy√™n n·ª£ ch·ªØ c√°i cu·ªëi "${selected.name.slice(-1)}" m√† ƒë∆∞·ª£c t·∫∑ng "${selected.name}". Link xem s·ª± t√≠ch: ${ghUrl}`;
        navigator.clipboard.writeText(prompt);
        
        const urls = { chatgpt: "https://chatgpt.com", gemini: "https://gemini.google.com", grok: "https://x.com/i/grok", deepseek: "https://chat.deepseek.com" };
        window.open(urls[type], "_blank");
    }

    function exportJson() {
        const blob = new Blob([JSON.stringify(warehouse, null, 2)], {type: 'application/json'});
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'files.json'; a.click();
    }

    getLucky();
</script>
</body>
</html>
