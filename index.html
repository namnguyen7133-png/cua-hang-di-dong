<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>ÄÆ°á»ng Äua Marketing NhÃ­ V18.4</title>
    <style>
        :root { --step1: #ff4757; --step2: #ffa502; --step3: #2ed573; --step4: #1e90ff; --step5: #3742fa; --step6: #ed4c67; }
        body { font-family: 'Segoe UI', cursive; background: #f1f2f6; padding: 20px; color: #2f3542; }
        
        /* Hiá»‡u á»©ng tráº¡m dá»«ng chÃ¢n */
        .station { background: white; border-radius: 20px; padding: 25px; margin-bottom: 30px; box-shadow: 0 10px 0 #dfe4ea; border: 4px solid transparent; position: relative; }
        .station h2 { margin-top: 0; font-size: 22px; color: white; padding: 10px 20px; border-radius: 15px; display: inline-block; transform: rotate(-2deg); margin-bottom: 20px; }
        
        .s1 { border-color: var(--step1); } .s1 h2 { background: var(--step1); }
        .s2 { border-color: var(--step2); } .s2 h2 { background: var(--step2); }
        .s3 { border-color: var(--step3); } .s3 h2 { background: var(--step3); }
        .s4 { border-color: var(--step4); } .s4 h2 { background: var(--step4); }
        .s5 { border-color: var(--step5); } .s5 h2 { background: var(--step5); }
        .s6 { border-color: var(--step6); } .s6 h2 { background: var(--step6); }

        /* Danh sÃ¡ch ngÆ°á»i */
        .m-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 12px; }
        .m-btn { padding: 15px; border: 2px solid #f1f2f6; border-radius: 15px; cursor: pointer; background: #fff; font-weight: bold; transition: 0.3s; }
        .m-btn.active { background: #ffa502; color: white; border-color: #ff7f50; transform: scale(1.05); }

        /* Táº§ng giÃ¡ */
        .price-wheel { display: flex; gap: 15px; margin-bottom: 20px; }
        .p-btn { flex: 1; padding: 15px; border: none; border-radius: 50px; cursor: pointer; font-weight: bold; color: white; opacity: 0.6; }
        .p-btn.active { opacity: 1; transform: translateY(-5px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }

        /* Khu vá»±c hiá»ƒn thá»‹ quÃ  */
        .gift-box { background: #f9f9f9; padding: 20px; border-radius: 15px; border: 3px dashed #ccc; text-align: center; }
        .btn-big { padding: 15px 30px; font-size: 18px; border-radius: 50px; border: none; color: white; cursor: pointer; font-weight: bold; transition: 0.3s; width: 100%; margin: 10px 0; }
        
        input.big-input { width: 100%; padding: 15px; border: 3px solid var(--step5); border-radius: 15px; font-size: 16px; text-align: center; }
        
        .lucky-label { position: absolute; top: -15px; right: 20px; background: #ff4757; color: white; padding: 5px 15px; border-radius: 20px; font-size: 12px; animation: bounce 2s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
    </style>
</head>
<body>

<h1 style="text-align: center; font-size: 35px; color: #2f3542; text-shadow: 2px 2px #fff;">ğŸš© ÄÆ¯á»œNG ÄUA MARKETING NHÃ V18.4</h1>

<div class="station s1">
    <h2>ğŸ TRáº M 1: Náº P KHO HÃ€NG Cá»¦A Bá»</h2>
    <input type="file" id="csv" multiple accept=".csv" style="width: 100%; padding: 20px; border: 3px dashed var(--step1); border-radius: 15px;">
</div>

<div class="station s2">
    <h2>ğŸ¯ TRáº M 2: AI LÃ€ NGÆ¯á»œI MAY Máº®N?</h2>
    <div id="mList" class="m-grid"></div>
</div>

<div class="station s3">
    <h2>ğŸ’° TRáº M 3: CHá»ŒN Táº¦NG GIÃ Äá»ŠNH Má»†NH</h2>
    <div class="price-wheel">
        <button class="p-btn active" style="background:#2ecc71" onclick="setPrice('L', 0, 50000, this)">L (DÆ°á»›i 50k)</button>
        <button class="p-btn" style="background:#3498db" onclick="setPrice('T', 50000, 200000, this)">T (50k - 200k)</button>
        <button class="p-btn" style="background:#9b59b6" onclick="setPrice('D', 200000, 1000000, this)">D (200k - 1tr)</button>
        <button class="p-btn" style="background:#e67e22" onclick="setPrice('C', 1000000, 99999999, this)">C (TrÃªn 1tr)</button>
    </div>
    <div id="autoSuggest" class="gift-box">
        <p><i>Äang chá» chá»n NgÆ°á»i may máº¯n á»Ÿ Tráº¡m 2...</i></p>
    </div>
</div>

<div class="station s4" id="station4" style="display:none">
    <h2>ğŸ”— TRáº M 4: Láº¤Y LINK Gá»C Äá»‚ RÃšT Gá»ŒN</h2>
    <p id="prodNameDisplay" style="font-size: 20px; font-weight: bold;"></p>
    <button class="btn-big" style="background: var(--step4);" onclick="openOriginal()">ğŸš€ Báº¤M Äá»‚ Má» SHOPEE Gá»C</button>
</div>

<div class="station s5" id="station5" style="display:none">
    <h2>ğŸ’ TRáº M 5: DÃN LINK RÃšT Gá»ŒN (AFFILIATE)</h2>
    <input type="text" id="affLink" class="big-input" placeholder="DÃ¡n link rÃºt gá»n vÃ o Ä‘Ã¢y nÃ¨ cÃ¡c bÃ© Æ¡i...">
    <button class="btn-big" style="background: var(--g); background: #27ae60; margin-top: 15px;" onclick="saveAff()">âœ… XÃC NHáº¬N VÃ€ LÆ¯U VÃ€O KHO</button>
</div>

<div class="station s6" id="station6" style="display:none">
    <h2>ğŸ“– TRáº M 6: VIáº¾T TRUYá»†N NGá»¤ NGÃ”N & ÄÄ‚NG FB</h2>
    <button class="btn-big" style="background: var(--step6);" onclick="goAI()">ğŸ§™â€â™‚ï¸ NHá»œ PHÃ™ THá»¦Y AI VIáº¾T TRUYá»†N</button>
    <button class="btn-big" style="background: #333;" onclick="exportJson()">ğŸ’¾ XUáº¤T FILE FILES.JSON CHO Bá»</button>
</div>

<script>
    const fixedMems = [
        {n:"NGUYá»„N KHáº®C NÄ‚NG", d:"1944-06-04", g:"Nam"}, {n:"TÃ” THá»Š HÃ€", d:"1948-08-29", g:"Ná»¯"},
        {n:"NGUYá»„N MINH NAM", d:"1971-03-03", g:"Nam"}, {n:"THÃ‚N THá»Š KIM ANH", d:"1981-09-23", g:"Ná»¯"},
        {n:"NGUYá»„N TÃ” NGÃ‚N AN", d:"2014-09-28", g:"Ná»¯"}, {n:"NGUYá»„N TÃ” MINH CHÃ‚U", d:"2016-07-25", g:"Ná»¯"},
        {n:"NGUYá»„N TÃ” BÃCH NGá»ŒC", d:"2020-02-05", g:"Ná»¯"}, {n:"NGUYá»„N THá»Š MINH Háº°NG", d:"1974-01-07", g:"Ná»¯"},
        {n:"NGÃ” QUÃ CÆ¯á»œNG", d:"1973-05-23", g:"Nam"}, {n:"NGÃ” GIA BÃCH", d:"2000-10-12", g:"Nam"},
        {n:"NGÃ” GIA LINH", d:"2005-04-05", g:"Ná»¯"}, {n:"NGUYá»„N THá»Š MINH PHÆ¯Æ NG", d:"1978-11-06", g:"Ná»¯"},
        {n:"HOÃ€NG ANH DÅ¨NG", d:"1978-09-21", g:"Nam"}, {n:"HOÃ€NG Háº¢I VINH", d:"2010-06-03", g:"Nam"},
        {n:"HOÃ€NG THIÃŠN Báº CH ANH", d:"2015-11-14", g:"Ná»¯"}, {n:"TÃ” KIM HUá»†", d:"1960-08-09", g:"Ná»¯"},
        {n:"NGUYá»„N TUáº¤N ANH", d:"1983-10-23", g:"Nam"}, {n:"NGUYá»„N THáº¾ ANH", d:"2001-03-24", g:"Nam"},
        {n:"NGÃ” THá»Š MAI", d:"1948-12-12", g:"Ná»¯"}, {n:"TÃ” VIá»†T HÆ¯NG", d:"1996-06-17", g:"Nam"},
        {n:"TÃ” THá»Š Há»’NG", d:"1964-10-10", g:"Ná»¯"}, {n:"VÅ¨ VÄ‚N HIá»†P", d:"1974-04-24", g:"Nam"},
        {n:"NGUYá»„N THá»Š CHI", d:"1946-02-08", g:"Ná»¯"}, {n:"NGUYá»„N TÃ‚N Báº®C", d:"1957-11-30", g:"Nam"},
        {n:"NGUYá»„N THá»Š TÃ‚M", d:"1954-08-08", g:"Ná»¯"}, {n:"THÃ‚N VÄ‚N GIá»®", d:"1955-04-18", g:"Nam"},
        {n:"NGUYá»„N THá»Š BÃŒNH", d:"1958-05-21", g:"Ná»¯"}, {n:"THÃ‚N THá»Š BÃCH NGUYá»†T", d:"1980-05-21", g:"Ná»¯"},
        {n:"THÃ‚N VÄ‚N TUáº¤N", d:"1983-05-21", g:"Nam"}, {n:"THÃ‚N Yáº¾N NHI", d:"2010-03-26", g:"Ná»¯"},
        {n:"LÃŠ THá»Š PHÆ¯Æ NG", d:"1990-06-26", g:"Ná»¯"}, {n:"NGUYá»„N HOÃ€I NAM", d:"2004-06-02", g:"Nam"}
    ];

    let warehouse = JSON.parse(localStorage.getItem('war_v18_4')) || [];
    let selM = null;
    let selP = null;
    let priceRange = { min: 0, max: 50000 };

    // 1. CSV
    document.getElementById('csv').onchange = async (e) => {
        const files = Array.from(e.target.files);
        for (const file of files) {
            const text = await file.text();
            const lines = text.split('\n').slice(1);
            lines.forEach(l => {
                const c = l.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                if(c.length >= 5) {
                    const id = c[0].trim();
                    const url = c[c.length-1].trim().replace(/"/g, '');
                    if(!warehouse.some(x => x.id === id)) {
                        warehouse.push({ id, name: c[1].replace(/"/g, ''), price: parseInt(c[2].replace(/[^0-9]/g, '')), originalLink: url, linkAffiliate: "" });
                    }
                }
            });
        }
        localStorage.setItem('war_v18_4', JSON.stringify(warehouse));
        alert("ÄÃ£ nháº­p kho thÃ nh cÃ´ng!");
    };

    // 2. Render NgÆ°á»i
    function renderM() {
        const lucky = fixedMems[Math.floor((new Date() - new Date("2024-01-01"))/(1000*60*60*24)) % fixedMems.length];
        document.getElementById('mList').innerHTML = fixedMems.map(m => `
            <button class="m-btn ${selM?.n === m.n ? 'active' : ''}" onclick='selectM(${JSON.stringify(m)})'>
                ${lucky.n === m.n ? '<span class="lucky-label">MAY Máº®N HÃ”M NAY</span>' : ''}
                ${m.n}<br><small>${m.g} - ${m.d.split('-')[0]}</small>
            </button>
        `).join('');
    }

    function selectM(m) { 
        selM = m; 
        selP = null; // Reset quÃ  khi chá»n ngÆ°á»i má»›i
        renderM(); 
        autoSuggest(); 
    }

    // 3. Táº§ng giÃ¡ & Gá»£i Ã½ tá»± Ä‘á»™ng
    function setPrice(t, min, max, btn) {
        priceRange = { min, max };
        document.querySelectorAll('.p-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        autoSuggest();
    }

    function autoSuggest() {
        if(!selM) return;
        const lastChar = selM.n.trim().slice(-1).toUpperCase();
        let pool = warehouse.filter(p => 
            p.name.trim().slice(-1).toUpperCase() === lastChar && 
            p.price >= priceRange.min && p.price <= priceRange.max
        );

        const area = document.getElementById('autoSuggest');
        if(pool.length > 0) {
            selP = pool[Math.floor(Math.random() * pool.length)];
            area.innerHTML = `
                <div style="font-size:24px; color:var(--step3); margin-bottom:10px;">ğŸŒŸ QUÃ€ Äá»ŠNH Má»†NH ÄÃƒ CHá»ŒN:</div>
                <div style="font-size:20px; font-weight:bold;">${selP.name}</div>
                <div style="color:#ff4757; font-size:22px;">GiÃ¡: ${selP.price.toLocaleString()}Ä‘</div>
                <button class="btn-big" style="background:var(--step3)" onclick="confirmGift()">Äá»’NG Ã - SANG TRáº M 4 THÃ”I!</button>
            `;
        } else {
            area.innerHTML = `<p>KhÃ´ng tÃ¬m tháº¥y quÃ  káº¿t thÃºc báº±ng chá»¯ "<b>${lastChar}</b>" á»Ÿ táº§ng giÃ¡ nÃ y. Thá»­ táº§ng giÃ¡ khÃ¡c xem bÃ©!</p>`;
        }
    }

    // CÃ¡c tráº¡m tiáº¿p theo
    function confirmGift() {
        document.getElementById('station4').style.display = 'block';
        document.getElementById('prodNameDisplay').innerText = "MÃ³n quÃ : " + selP.name;
        document.getElementById('station4').scrollIntoView({behavior: "smooth"});
    }

    function openOriginal() {
        window.open(selP.originalLink, '_blank');
        document.getElementById('station5').style.display = 'block';
    }

    function saveAff() {
        const link = document.getElementById('affLink').value;
        if(!link) { alert("DÃ¡n link vÃ o Ä‘Ã£ bÃ© Æ¡i!"); return; }
        selP.linkAffiliate = link;
        const idx = warehouse.findIndex(x => x.id === selP.id);
        warehouse[idx] = selP;
        localStorage.setItem('war_v18_4', JSON.stringify(warehouse));
        alert("ÄÃ£ lÆ°u link thÃ nh cÃ´ng!");
        document.getElementById('station6').style.display = 'block';
    }

    function goAI() {
        const ghUrl = `https://namnguyen7133-png.github.io/cua-hang-di-dong/001-kho-hang.html?id=${selP.id}`;
        let prompt = `Viáº¿t má»™t cÃ¢u chuyá»‡n ngá»¥ ngÃ´n hÃ i hÆ°á»›c vá» ${selM.n}. VÃ¬ cÃ¡i duyÃªn chá»¯ cÃ¡i cuá»‘i "${selM.n.slice(-1)}" mÃ  Ä‘á»‹nh má»‡nh táº·ng mÃ³n quÃ  "${selP.name}". Káº¿t bÃ i nhá» má»i ngÆ°á»i click link GitHub nÃ y xem sá»± tÃ­ch vÃ  mua á»§ng há»™: ${ghUrl}`;
        navigator.clipboard.writeText(prompt);
        alert("ÄÃ£ copy truyá»‡n! Sang AI dÃ¡n vÃ o lÃ  xong nhÃ©.");
        window.open("https://chatgpt.com", "_blank");
    }

    function exportJson() {
        const blob = new Blob([JSON.stringify(warehouse, null, 2)], {type: 'application/json'});
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'files.json'; a.click();
    }

    renderM();
</script>
</body>
</html>
