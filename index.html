<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>H·ªá Th·ªëng Marketing Gia ƒê√¨nh - Qu·∫£n L√Ω Kho</title>
    <style>
        :root { --p: #ee4d2d; --s: #1877F2; --v: #9b59b6; --g: #27ae60; --dark: #2d3436; }
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; padding: 20px; }
        .box { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 20px; }
        
        /* Member Grid */
        .member-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 10px; margin: 15px 0; max-height: 200px; overflow-y: auto; }
        .m-btn { padding: 10px; border: 1px solid #ddd; border-radius: 8px; cursor: pointer; background: #fff; font-size: 11px; position: relative; }
        .m-btn.active { background: var(--v); color: white; }
        .del-x { position: absolute; top: -5px; right: -5px; background: red; color: white; border: none; border-radius: 50%; width: 20px; height: 20px; cursor: pointer; }

        /* Warehouse Table */
        .scroll-table { max-height: 400px; overflow-y: auto; border: 1px solid #eee; margin-top: 10px; }
        table { width: 100%; border-collapse: collapse; background: white; }
        th { background: var(--dark); color: white; padding: 10px; position: sticky; top: 0; }
        td { border-bottom: 1px solid #eee; padding: 8px; text-align: center; font-size: 12px; }
        
        /* Controls */
        input, select { padding: 8px; border: 1px solid #ddd; border-radius: 5px; }
        .btn { border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; color: white; font-weight: bold; }
        .btn-sm { padding: 5px 10px; font-size: 10px; }
        .search-box { width: 100%; padding: 10px; margin-bottom: 10px; border: 2px solid var(--s); border-radius: 10px; }
    </style>
</head>
<body>

<div style="max-width: 1100px; margin: auto;">
    <h1 style="text-align: center; color: var(--p);">üöÄ ƒêI·ªÄU H√ÄNH KHO & AI MARKETING</h1>

    <div class="box" style="background: #fff3bf;">
        <strong>üåê WEB GITHUB:</strong> 
        <input type="text" id="ghBase" style="width: 60%;" value="https://namnguyen7133.github.io/kho-hang/" onchange="saveConfig()">
        <button class="btn" style="background:var(--g)" onclick="exportJson()">üíæ Xu·∫•t files.json</button>
    </div>

    <div class="box">
        <h2>1. NG∆Ø·ªúI NH·∫¨N (${members.length})</h2>
        <div style="margin-bottom: 10px;">
            <input type="text" id="inN" placeholder="T√™n kh√°ch...">
            <input type="date" id="inD">
            <button class="btn" style="background:var(--s)" onclick="addM()">+ Th√™m</button>
        </div>
        <div class="member-grid" id="mList"></div>
    </div>

    <div class="box">
        <h2>2. QU·∫¢N L√ù KHO H√ÄNG (<span id="countP">0</span> m√≥n)</h2>
        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
            <input type="file" id="csv" multiple accept=".csv" class="btn" style="background:#eee; color:#333; flex:1">
            <button class="btn" style="background:#ff4757" onclick="clearWare()">üóëÔ∏è X√≥a s·∫°ch kho</button>
        </div>
        
        <input type="text" id="searchP" class="search-box" placeholder="üîç T√¨m t√™n s·∫£n ph·∫©m trong kho..." oninput="renderW()">

        <div class="scroll-table">
            <table>
                <thead>
                    <tr>
                        <th width="50">X√≥a</th>
                        <th>T√™n S·∫£n Ph·∫©m</th>
                        <th width="180">Link GitHub</th>
                        <th width="180">G·ªçi AI</th>
                    </tr>
                </thead>
                <tbody id="pArea"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    // D·ªØ li·ªáu m·∫´u (B·ªë h√£y d√°n danh s√°ch 32 ng∆∞·ªùi v√†o ƒë√¢y)
    let members = JSON.parse(localStorage.getItem('mems_v5')) || [
        {n:"NGUY·ªÑN KH·∫ÆC NƒÇNG", d:"1944-06-04", g:"Nam"},
        {n:"T√î TH·ªä H√Ä", d:"1948-08-29", g:"N·ªØ"}
    ];
    let warehouse = JSON.parse(localStorage.getItem('ware_v5')) || [];
    let activeM = null;

    function saveConfig() { localStorage.setItem('ghBase', document.getElementById('ghBase').value); renderW(); }

    // --- QU·∫¢N L√ù NG∆Ø·ªúI ---
    function renderM() {
        const list = document.getElementById('mList');
        list.innerHTML = members.map((m, i) => `
            <div style="position:relative">
                <button class="m-btn ${activeM && activeM.n === m.n ? 'active' : ''}" onclick='activeM=members[${i}];renderM()'>
                    <b>${m.n}</b><br><small>${calcAge(m.d)} tu·ªïi</small>
                </button>
                <button class="del-x" onclick="delM(${i})">√ó</button>
            </div>
        `).join('');
    }
    function addM() {
        const n = document.getElementById('inN').value;
        const d = document.getElementById('inD').value;
        if(n && d) { members.unshift({n, d, g:"Nam"}); saveM(); }
    }
    function delM(i) { members.splice(i,1); saveM(); }
    function saveM() { localStorage.setItem('mems_v5', JSON.stringify(members)); renderM(); }
    function calcAge(d) { return Math.floor((new Date() - new Date(d))/31557600000); }

    // --- QU·∫¢N L√ù KHO ---
    document.getElementById('csv').onchange = async (e) => {
        const files = Array.from(e.target.files);
        for (const file of files) {
            const text = await file.text();
            const lines = text.split('\n').slice(1);
            lines.forEach(l => {
                const c = l.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                if(c.length >= 2) {
                    const id = c[0].trim();
                    if(!warehouse.some(p => p.id === id)) {
                        warehouse.push({ id, n: c[1]?.replace(/"/g, '').split(' ').slice(0, 6).join(' ').trim() });
                    }
                }
            });
        }
        saveW();
    };

    function renderW() {
        const area = document.getElementById('pArea');
        const search = document.getElementById('searchP').value.toLowerCase();
        const ghBase = document.getElementById('ghBase').value;
        
        const filtered = warehouse.filter(p => p.n.toLowerCase().includes(search));
        document.getElementById('countP').innerText = warehouse.length;

        area.innerHTML = filtered.slice().reverse().map((p, idx) => {
            const finalLink = `${ghBase}${p.id}.html`; // Ho·∫∑c c·∫•u h√¨nh link theo √Ω b·ªë
            return `
                <tr>
                    <td><button class="btn-sm" style="background:#ff4757;border:none;color:white;border-radius:4px" onclick="delP('${p.id}')">X√≥a</button></td>
                    <td style="text-align:left">${p.n}</td>
                    <td><small style="color:blue">${p.id}.html</small></td>
                    <td>
                        <button class="btn-sm" style="background:var(--v);border:none;color:white" onclick="goAI('DeepSeek','${p.id}','${finalLink}')">DS</button>
                        <button class="btn-sm" style="background:var(--s);border:none;color:white" onclick="goAI('Gemini','${p.id}','${finalLink}')">GM</button>
                    </td>
                </tr>
            `;
        }).join('');
    }

    function delP(id) {
        warehouse = warehouse.filter(p => p.id !== id);
        saveW();
    }

    function clearWare() {
        if(confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a s·∫°ch to√†n b·ªô kho h√†ng kh√¥ng?")) {
            warehouse = [];
            saveW();
        }
    }

    function saveW() {
        localStorage.setItem('ware_v5', JSON.stringify(warehouse));
        renderW();
    }

    function goAI(ai, id, link) {
        if(!activeM) return alert("B√© ch·ªçn ng∆∞·ªùi nh·∫≠n tr∆∞·ªõc!");
        const p = warehouse.find(x => x.id === id);
        const prompt = `Vi·∫øt truy·ªán h√†i Facebook v·ªÅ ${activeM.n} (${calcAge(activeM.d)}t) g·∫Øn v·ªõi m√≥n ${p.n}. Link xem: ${link}`;
        navigator.clipboard.writeText(prompt).then(() => {
            alert("ƒê√£ copy l·ªánh AI!");
            window.open(ai === 'DeepSeek' ? "https://chat.deepseek.com" : "https://gemini.google.com/app", "_blank");
        });
    }

    function exportJson() {
        const blob = new Blob([JSON.stringify(warehouse, null, 2)], {type: 'application/json'});
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'files.json'; a.click();
    }

    renderM();
    renderW();
</script>
</body>
</html>
